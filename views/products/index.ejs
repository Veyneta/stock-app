<%- include('../partials/header', { title: title }) %>

<div class="page-header">
  <div>
    <h1>สินค้า</h1>
    <p class="muted">จัดการสินค้าและยอดคงเหลือ</p>
  </div>
  <div class="actions">
    <a class="btn btn-primary" href="/products/new">เพิ่มสินค้า</a>
    <a class="btn btn-ghost" href="/export/products.csv">ส่งออก CSV</a>
  </div>
</div>

<form class="filters" method="get" action="/products">
  <input type="text" name="q" value="<%= query %>" placeholder="ค้นหาด้วยชื่อสินค้า" />
  <label class="checkbox">
    <input type="checkbox" name="low" value="1" <%= onlyLow ? 'checked' : '' %> />
    เฉพาะสต๊อกต่ำ
  </label>
  <button class="btn btn-ghost" type="submit">กรอง</button>
</form>

<div class="table-wrap desktop-only">
  <table>
    <thead>
      <tr>
        <th>ชื่อ</th>
        <th>หน่วย</th>
        <th>คงเหลือ</th>
        <th>ขั้นต่ำ</th>
        <th>สถานะ</th>
        <th>การทำงาน</th>
      </tr>
    </thead>
    <tbody>
      <% if (products.length === 0) { %>
        <tr>
          <td colspan="6" class="muted">ไม่พบสินค้า</td>
        </tr>
      <% } %>
      <% products.forEach((product) => { %>
        <tr>
          <td><%= product.name %></td>
          <td><%= product.unit %></td>
          <td><%= product.stock %></td>
          <td><%= product.min_qty %></td>
          <td>
            <% if (product.stock <= product.min_qty) { %>
              <span class="badge badge-warning">ต่ำ</span>
            <% } else { %>
              <span class="badge badge-ok">ปกติ</span>
            <% } %>
          </td>
          <td class="table-actions">
            <a class="link" href="/movements/new?productId=<%= product.id %>">ทำรายการ</a>
            <a class="link" href="/products/<%= product.id %>/edit">แก้ไข</a>
            <form action="/products/<%= product.id %>/delete" method="post" class="inline-form">
              <button class="link danger" type="submit" onclick="return confirm('ลบสินค้านี้หรือไม่?');">ลบ</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<div class="card mobile-only">
  <% if (products.length === 0) { %>
    <p class="muted">ไม่พบสินค้า</p>
  <% } %>
  <div class="list">
    <% products.forEach((product) => { %>
      <div class="product-card">
        <div class="movement-row">
          <strong><%= product.name %></strong>
          <% if (product.stock <= product.min_qty) { %>
            <span class="badge badge-warning">ต่ำ</span>
          <% } else { %>
            <span class="badge badge-ok">ปกติ</span>
          <% } %>
        </div>
        <div class="movement-row muted">
          <span>คงเหลือ <%= product.stock %> <%= product.unit %></span>
          <span>ขั้นต่ำ <%= product.min_qty %></span>
        </div>
        <div class="product-actions">
          <a class="link" href="/movements/new?productId=<%= product.id %>">ทำรายการ</a>
          <a class="link" href="/products/<%= product.id %>/edit">แก้ไข</a>
          <form action="/products/<%= product.id %>/delete" method="post" class="inline-form">
            <button class="link danger" type="submit" onclick="return confirm('ลบสินค้านี้หรือไม่?');">ลบ</button>
          </form>
        </div>
      </div>
    <% }) %>
  </div>
</div>

<%- include('../partials/footer') %>
